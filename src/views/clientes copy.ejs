<%- include('partials/_header') %>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<div class="container">
    <div class="row mt-5">
        <div class="col-md-12">
            <div class="col-md-12">
                <div class="card ">
                    
                    <div class="card-body col-md-12">
                      
                        <div class="col-md-10" style="margin:0 auto">
                            <form class="row g-3" action="/cliente/add" method="post">
                              <div class="card-header bg-dark text-white d-flex">
                                <div class="col-9"><h5>Información - Básica - Cliente</h5></div>
                                
                                <label for="inputAddress2" class="form-label text-white">Fecha:</label>
                                    <input type="text" class="form-control bg-dark text-white" name="fecha" id="fecha" required readonly>
                                  
                            </div>
                                <div class="col-md-4">
                                    <label for="inputAddress2" class="form-label text-black">Nombres <strong style="color: red;">*</strong></label>
                                    <input type="text" class="form-control" name="nombres" id="nombres" placeholder="Mel Patsy" required>
                                  </div>
                                  <div class="col-md-4">
                                    <label for="inputAddress2" class="form-label text-black">Apellidos <strong style="color: red;">*</strong></label>
                                    <input type="text" class="form-control" name="apellidos" id="apellidos" placeholder="Martínez Darcy" required>
                                  </div>
                                  <div class="col-md-4">
                                    
                                    <label for="inputAddress2" class="form-label text-black">Cédula <strong style="color: red;">*</strong></label>
                                    <input type="text" class="form-control" name="cedula" id="cedula" onkeypress="handleMask(event, '999-9999999-9')" size=13 placeholder="000-0000000-0" required>
                                  </div>

                                  <div class="col-md-4">
                                    
                                    <label for="inputAddress2" class="form-label text-black">Pasaporte <strong style="color: red;">*</strong></label>
                                    <input type="text" class="form-control" name="pasaporte" id="pasaporte" onkeypress="handleMask(event, '999-9999999-9')" size=13 placeholder="000-0000000-0" required>
                                  </div>
                               
                               <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Sexo <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="sexo" id="sexo" required>
                                   <option value="0">Seleccione el Sexo</option>
                                   <option value="M">Masculino</option>
                                   <option value="F">Femenino</option>
                                 </select>
                              </div>

                              <div class="col-md-4">
                                <label for="inputAddress2" class="form-label text-black">Fecha de Nacimiento <strong style="color: red;">*</strong></label>
                                <input type="date" class="form-control" name="fecha_nacimiento" id="fecha_nacimiento" placeholder="000-0000000-0" required>
                              </div>

                              

                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Estado Civil <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="estado_civil" id="estado_civil" required>
                                   <option value="0">Seleccione el Estado Civil</option>
                                   <option value="soltero">Soltero</option>
                                   <option value="casado">Casado</option>
                                   <option value="union libre">Unión Libre</option>
                                   <option value="separado">Separado</option>
                                   <option value="divorciado">Divorciado</option>
                                   <option value="viudo">Viudo</option>
                                 </select>
                              </div>

                               <div class="col-md-4">
                                 <label for="inputPassword4" class="form-label text-black">No. Dependientes <strong style="color: red;">*</strong></label>
                                 <input type="number" class="form-control" name="ndependientes" id="ndependientes" placeholder="00" required>
                               </div>     

                               <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Nacionalidad <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="nacionalidad" id="nacionalidad" required>
                                  <option value="0">Seleccione la Nacionalidad</option>
                                 
                                  <% if(nac) {%>
                                    <% for(var i =0;i < nac.length;i++){ %>
                                      <option value="<%= nac[i].id_nacionalidad %>"><%= nac[i].gentilicio %></option>
                                       
                                     <% } %>
                                    <% } %>
                                   
                                 </select>
                              </div>
                               
                               <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Provincia <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="provincia" id="provincia" required>
                                   <option value="0">Seleccione la Provincia</option>
                                  <% if(prov) {%>
                                    <% for(var i =0;i < prov.length;i++){ %>
                                      <option value="<%= prov[i].id_provincia %>"><%= prov[i].provincia %></option>
                                       
                                     <% } %>
                                    <% } %>
                                 </select>
                              </div>

                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Municipio <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="municipio" id="municipio" required>
                                   
                                 </select>
                              </div>

                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Sector <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="sector" id="sector" required>
                                   
                                 </select>
                              </div>

                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Dirección <strong style="color: red;">*</strong></label>
                                <input type="text" class="form-control" name="direccion" id="direccion" placeholder="C/principal #22" required>
                              </div>  

                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Geo referencia <strong style="color: red;">*</strong></label>
                                <input type="text" class="form-control" name="geo" id="geo" placeholder="C/principal #22" required>
                              </div> 

                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Referencia 1<strong style="color: red;">*</strong></label>
                                <input type="text" class="form-control" name="ref1" id="ref1" placeholder="C/principal #22" required>
                              </div> 

                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Referencia 2<strong style="color: red;">*</strong></label>
                                <input type="text" class="form-control" name="ref2" id="ref2" placeholder="C/principal #22" required>
                              </div> 

                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Referencia 3<strong style="color: red;">*</strong></label>
                                <input type="text" class="form-control" name="ref3" id="ref3" placeholder="C/principal #22" required>
                              </div> 

                              <div class="card-header mt-5 bg-dark text-white">
                                <h5>Información - Contacto</h5>
                            </div>

                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Teléfono</label>
                                <input type="text" class="form-control" name="telefono" id="telefono" onkeypress="handleMask(event, '999-999-9999')" size=13 placeholder="000-000-0000">
                              </div>  
                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Celular <strong style="color: red;">*</strong></label>
                                <input type="text" class="form-control" name="celular" id="celular" onkeypress="handleMask(event, '999-999-9999')" size=13 placeholder="000-000-0000" required>
                              </div>  
                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Correo Electrónico <strong style="color: red;">*</strong></label>
                                <input type="email" class="form-control" name="email_personal" id="email_personal" placeholder="example@gmail.com" required>
                              </div>  















                              <div class="card-header mt-5 bg-dark text-white">
                                <h5>Información - Académica</h5>
                            </div>
                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Grado Académico <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="grado_ac" id="grado_ac" required>
                                   <option value="0">Seleccione el grado académico</option>
                                   <% if(graac) {%>
                                    <% for(var i =0;i < graac.length;i++){ %>
                                      <option value="<%= graac[i].id_grado_ac %>"><%= graac[i].descripcion %></option>
                                       
                                     <% } %>
                                    <% } %>
                                 </select>
                              </div>

                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Nivel <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="nivel" id="nivel" required>
                                   <option value="0">Seleccione el nivel</option>
                                   <% if(niv) {%>
                                    <% for(var i =0;i < niv.length;i++){ %>
                                      <option value="<%= niv[i].id_nivel %>"><%= niv[i].descripcion %></option>
                                       
                                     <% } %>
                                    <% } %>
                                 </select>
                              </div>
                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Ocupación</label>
                                <select class="form-control" name="ocupacion" id="ocupacion" required>
                                  <option value="0">Seleccione la Nacionalidad</option>
                                 
                                  <% if(nac) {%>
                                    <% for(var i =0;i < nac.length;i++){ %>
                                      <option value="<%= nac[i].id_nacionalidad %>"><%= nac[i].gentilicio %></option>
                                       
                                     <% } %>
                                    <% } %>
                                   
                                 </select>
                              </div>
                              <div class="card-header mt-5 bg-dark text-white">
                                <h5>Información - Empresa</h5>
                            </div>
                            <% if(accesos.master) {%>
                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Empresa<strong style="color: red;">*</strong></label>
                                <select class="form-control" name="empresa" id="empresa" required>
                                   <option value="">Seleccione la empresa</option>
                                   <% if(emp) {%>
                                    <% for(var i =0;i < emp.length;i++){ %>
                                      <option value="<%= emp[i].id_negocio %>"><%= emp[i].razon_social %></option>
                                       
                                     <% } %>
                                    <% } %>
                                 </select>
                              </div>
                              <% } else{ %>
                                <div class="col-md-4">
                                  <label for="inputPassword4" class="form-label text-black">Empresa<strong style="color: red;">*</strong></label>
                                  <input type="hidden" class="form-control" name="empresa" id="empresa" value="<%= empresa %>">
                                  <% if(emp) {%>
                                    <% for(var i =0;i < emp.length;i++){ 
                                      if(emp[i].id_negocio == empresa){%>
                                        <input type="text" class="form-control" name="empresa" id="empresa" value="<%= emp[i].razon_social %>" disabled>
                                      <% }else{ %>
                                        
                                        <% } %>
                                     <% } %>
                                    <% } %>
                                </div> 
                                <% } %>

                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Sucursal <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="sucursal" id="sucursal" required>
                                   <option value="0">Seleccione la sucursal</option>
                                   
                                 </select>
                              </div>

                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Cartera <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="grado" id="grado" required>
                                   <option value="">Seleccione el grado</option>
                                   <% if(gra) {%>
                                    <% for(var i =0;i < gra.length;i++){ %>
                                      <option value="<%= gra[i].id_grado %>"><%= gra[i].grado %></option>
                                       
                                     <% } %>
                                    <% } %>
                                 </select>
                              </div>

                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Estado <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="estado" id="estado" required>
                                   <option value="">Seleccione el Estado</option>
                                   <% if(est) {%>
                                    <% for(var i =0;i < est.length;i++){ %>
                                      <option value="<%= est[i].id_estado %>"><%= est[i].descripcion %></option>
                                       
                                     <% } %>
                                    <% } %>
                                 </select>
                              </div>

                              <div class="card-header mt-5 bg-dark text-white">
                                <h5><strong>Información - Emergencia</strong></h5>
                            </div>

                            <div class="col-md-12">
                              <label for="inputPassword4" class="form-label text-black">Contacto <strong style="color: red;">*</strong></label>
                              <input type="text" class="form-control" name="contacto" id="contacto" placeholder="Nombre y apellido" required>
                            </div>  

                              <div class="col-md-4">
                                <label for="inputEmail4" class="form-label text-black">Relación <strong style="color: red;">*</strong></label>
                                <select class="form-control" name="relacion" id="relacion">
                                  <option value="0">Seleccione</option>
                                  <% if(rel) {%>
                                   <% for(var i =0;i < rel.length;i++){ %>
                                       <option value="<%= rel[i].id_relacion %>"><%= rel[i].relacion %></option>
                                    <% } %>
                                   <% } %>
                                 </select>
                              </div>

                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Tel</label>
                                <input type="text" class="form-control" name="tel" id="tel" onkeypress="handleMask(event, '999-999-9999')" size=13 placeholder="000-000-0000">
                              </div>  

                              <div class="col-md-4">
                                <label for="inputPassword4" class="form-label text-black">Cel <strong style="color: red;">*</strong></label>
                                <input type="text" class="form-control" name="cel" id="cel" onkeypress="handleMask(event, '999-999-9999')" size=13 placeholder="000-000-0000" required>
                              </div> 


                              
                              <div class="card-header mt-5 bg-dark text-white">
                                <h5><strong>Información - Salud</strong></h5>
                            </div>

                            <div class="col-md-12">
                              <div class="col-md-8">
                                <label for="inputPassword4" class="form-label text-black">Padece alguna enfermedad <strong style="color: red;">*</strong></label>
                              </div>  
  
                                <div class="col-md-12 d-flex">
                                  <div class="col-md-3">
                                    <select class="form-control" name="enfermedad" id="enfermedad" required>
                                       <option value="">Seleccione</option>
                                       <option value="si">Si</option>
                                       <option value="no">No</option>
                                     </select>
                                     
                                  </div>
    
                                  <div class="col-md-9 mx-3">
                                    <input type="text" class="form-control" name="tipo_enfermedad" id="tipo_enfermedad" placeholder="Mal de parquinson">
                                  </div>  
                                </div>
                            </div>  

                            <div class="col-md-12">
                              <div class="col-md-8">
                                <label for="inputPassword4" class="form-label text-black">Alergias<strong style="color: red;">*</strong></label>
                              </div>  
  
                                <div class="col-md-12 d-flex">
                                  <div class="col-md-3">
                                    <select class="form-control" name="alergia" id="alergia" required>
                                       <option value="">Seleccione</option>
                                       <option value="si">Si</option>
                                       <option value="no">No</option>
                                     </select>
                                     
                                  </div>
    
                                  <div class="col-md-9 mx-3">
                                    <input type="text" class="form-control" name="tipo_alergia" id="tipo_alergia" placeholder="A la penicilina">
                                  </div>  
                                </div>
                            </div>  

                            <div class="col-md-12">
                              <div class="col-md-9">
                                <label for="inputPassword4" class="form-label text-black">Utiliza algún medicamento<strong style="color: red;">*</strong></label>
                              </div>  
  
                                <div class="col-md-12 d-flex">
                                  <div class="col-md-3">
                                    <select class="form-control" name="medicacion" id="medicacion" required>
                                       <option value="0">Seleccione</option>
                                       <option value="si">Si</option>
                                       <option value="no">No</option>
                                     </select>
                                     
                                  </div>
    
                                  <div class="col-md-9 mx-3">
                                    <input type="text" class="form-control" name="tipo_medicamento" id="tipo_medicamento" placeholder="Aspirina 500">
                                  </div>  
                                </div>
                            </div>  

                              
                         
                               <div class="col-12">
                                 <button type="submit" class="btn btn-primary">GUARDAR</button>
                               </div>

                             </form>
                           </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>



<script >


function handleNacionalidad() {
  console.log("ID: ");
  
  $.get("/empleado", function (data) {
      var municipios = data.municipios;

  });

}

function handleProvincia(e) {
  console.log("ID: ", e.target.value);

  $.get("/form-data/municipios?provincia=" + e.target.value, function (data) {
      var municipios = data.municipios;

     console.log(municipios)
  });
}

function handleMunicipio(e) {
  console.log("ID: ", e.target.value);

  $.get("/form_data/municipio/" + e.target.value, function (data) {
      console.log(data)
      var municipio = data;  // FALTA RENDERIZAR LOS DATOS EN EL SELECT
      var html = "";
      html +="<option value=0>Seleccione el municipio</option>";
      for(var i =0;i < data.length;i++){ 
              html +="<option value="+data[i].id_municipio+">"+data[i].municipio+"</option>";
              console.log(data[i]);                    
        }

      var elementMunicipio = document.getElementById("municipio");
      elementMunicipio.innerHTML = html;


      
  });
}

function handleSector(e) {
  //console.log("ID: ", e.target.value);

  $.get("/form_data/sector/" + e.target.value, function (data) {
      //console.log(data)
      var sector = data;  // FALTA RENDERIZAR LOS DATOS EN EL SELECT
      var html = "";
      html +="<option value=0>Seleccione el sector</option>";
      for(var i =0;i < data.length;i++){ 
              html +="<option value="+data[i].id_sector+">"+data[i].sector+"</option>";
              //console.log(data[i]);                    
        }

      var elementSector = document.getElementById("sector");
      elementSector.innerHTML = html;


      
  });
}

function handleEncargado(e) { // el id que llega es el id del departamento
  console.log("ID: ", e.target.value);

  $.get("/form_data/encargado/" + e.target.value, function (data) {
      //console.log(data)
      var sector = data;  // FALTA RENDERIZAR LOS DATOS EN EL SELECT
      var html = "";
      html +="<option value=0>Seleccione el encargado</option>";
      for(var i =0;i < data.length;i++){ 
              html +="<option value="+data[i].id_empleado+">"+data[i].nombres+" "+data[i].apellidos+"</option>";
              //console.log(data[i]);                    
        }

      var elementEncargado = document.getElementById("encargado");
      elementEncargado.innerHTML = html;
      
  });
}

function fechaActual(){
  date = new Date();
  year = date.getFullYear();
  month = date.getMonth() + 1;
  day = date.getDate();
  return  day + "/" + month + "/" + year;
  
}

function handleMask(event, mask) {
    with (event) {
        stopPropagation()
        preventDefault()
        if (!charCode) return
        var c = String.fromCharCode(charCode)
        if (c.match(/\D/)) return
        with (target) {
            var val = value.substring(0, selectionStart) + c + value.substr(selectionEnd)
            var pos = selectionStart + 1
        }
    }
    var nan = count(val, /\D/, pos) // nan va calcolato prima di eliminare i separatori
    val = val.replace(/\D/g,'')

    var mask = mask.match(/^(\D*)(.+9)(\D*)$/)
    if (!mask) return // meglio exception?
    if (val.length > count(mask[2], /9/)) return

    for (var txt='', im=0, iv=0; im<mask[2].length && iv<val.length; im+=1) {
        var c = mask[2].charAt(im)
        txt += c.match(/\D/) ? c : val.charAt(iv++)
    }

    with (event.target) {
        value = mask[1] + txt + mask[3]
        selectionStart = selectionEnd = pos + (pos==1 ? mask[1].length : count(value, /\D/, pos) - nan)
    }

    function count(str, c, e) {
        e = e || str.length
        for (var n=0, i=0; i<e; i+=1) if (str.charAt(i).match(c)) n+=1
        return n
    }
}

function puestoList(empresa) { // el id que llega es el id del departamento
    //console.log("ID: ", e.target.value);

    const jsonAccesos = '<%- JSON.stringify(accesos) %>';
    var accesos = JSON.parse(jsonAccesos);

   
    $.get("/form_data/puesto/" + empresa, function (data) {
        // console.log(data)
        
      html = "";
      html +="<option value=0>Seleccione el puesto</option>";
      for(var j =0;j < data[0].length;j++){ 
              html +="<option value="+data[0][j].id_puesto+">"+data[0][j].descripcion+"</option>";
              // console.log(data[i]);                    
        }

      var elementPuesto = document.getElementById("puesto");
      elementPuesto.innerHTML = html;
        
    });
 
  }

  
  function departamentoList(empresa) { // el id que llega es el id del departamento
    //console.log("ID: ", e.target.value);

    const jsonAccesos = '<%- JSON.stringify(accesos) %>';
    var accesos = JSON.parse(jsonAccesos);

   
    $.get("/form_data/departamento/" + empresa, function (data) {
        // console.log(data)  
        
        html = "";
      html +="<option value=0>Seleccione el departamento</option>";
      for(var j =0;j < data[0].length;j++){ 
              html +="<option value="+data[0][j].id_departamento+">"+data[0][j].descripcion+"</option>";
              // console.log(data[i]);                    
        }

      var elementPuesto = document.getElementById("departamento");
      elementPuesto.innerHTML = html;
    });
 
  }
  function sucursalList(empresa) { // el id que llega es el id del departamento
    // console.log("ID: ", empresa);

    const jsonAccesos = '<%- JSON.stringify(accesos) %>';
    var accesos = JSON.parse(jsonAccesos);

   
    $.get("/form_data/sucursal/" + empresa, function (data) {
        // console.log('Muestra data ========',data)
        
        html = "";
      html +="<option value=0>Seleccione la sucursal</option>";
      for(var j =0;j < data[0].length;j++){ 
              html +="<option value="+data[0][j].id_sucursal+">"+data[0][j].nombre_sucursal+"</option>";
              // console.log(data[i]);                    
        }

      var elementPuesto = document.getElementById("sucursal");
      elementPuesto.innerHTML = html;
    });
 
  }
window.addEventListener('load', function() {
  const jsonAccesos = '<%- JSON.stringify(accesos) %>';
    var accesos = JSON.parse(jsonAccesos);

    if(!accesos.master){
      const empre = '<%= empresa %>';
      puestoList(empre);
      departamentoList(empre);
      sucursalList(empre);
    }
  document.getElementById("empresa").onchange = function(e) {
      let valor = e.target.value;
      puestoList(valor);
      departamentoList(valor);
      sucursalList(valor);
      // document.getElementById("empresa").value = this.value;
    };
  
  // $(":input").inputmask();
  //const nacionalidad = document.getElementById("nacionalidad");
  //$("#fecha").val(fechaActual());
  document.getElementById("fecha").value = new Date().toLocaleDateString();
 
  document.getElementById("provincia").onchange = function(e) {
    handleMunicipio(e);
  };

  document.getElementById("municipio").onchange = function(e) {
    handleSector(e);
  };

  document.getElementById("puesto").onchange = function(e) {
    handleEncargado(e);
  };

});
</script>



<%- include('partials/_footer') %>